function Get-CyberCNSVulnerability {
   <#
      .SYNOPSIS
         Gets all CyberCNS Vulnerabilies or gets all CyberCNS vulnerabilies based on Company
      .EXAMPLE
         $vulns = Get-CyberCNSVulnerability
         $vulns = Get-CyberCNSCompany -Name ACME | Get-CyberCNSVulnerability
         $vulns = Get-CyberCNSVulnerability -CompanyId $company.Id
      .OUTPUTS
         Returns a list of Vulnerabilities
   #>
   [CmdletBinding()]
   param(
      #A Company from the pipeline
      [Parameter(ValueFromPipeline)]
      $Company,
      #The Id of the Company
      [String]
      $CompanyId
   )

   $companyid = ""
   if($Company) {
      $companyid = $Company.Id
   }
   
   if($CompanyId) {
      $companyid = $CompanyId
   }

   $params = @{
      "company_id" = $companyid
   }

   $RestParams = @{
      "Uri" = [System.Uri]"https://$($CyberCNSApiSession.Url)/vulnerability/api/auth_vul_summary/dummy/get_vulnerability_stats"
      "Method" = "POST"
      "Body" = ($params | ConvertTo-Json)
      "ContentType" = "application/json"
   }
   
   $vulns = $null

   $response = Invoke-RestMethod @RestParams -WebSession $CyberCNSApiSession.Session
   if($response.status -eq "ok") {
      foreach($product in $response.msg) {
         if($product.CRITICAL -gt 0) {
            $params = @{
               "company_id" = $companyid
               "operating_sys" = $product.os
               "severity" = "CRITICAL"
            }

            $RestParams = @{
               "Uri" = [System.Uri]"https://$($CyberCNSApiSession.Url)/vulnerability/api/auth_vul_summary/dummy/get_product_stats"
               "Method" = "POST"
               "Body" = ($params | ConvertTo-Json)
               "ContentType" = "application/json"
            }

            $statResponse = Invoke-RestMethod @RestParams -WebSession $CyberCNSApiSession.Session
            if($statResponse.status -eq "ok") {
               Write-Output $statResponse.msg
               Write-Output $statResponse.msg.product
               $params = @{
                  "company_id" = $companyid
                  "operating_sys" = $product.os
                  "product" = $statResponse.msg.product
                  "severity" = "CRITICAL"
               }

               $RestParams = @{
                  "Uri" = [System.Uri]"https://$($CyberCNSApiSession.Url)/vulnerability/api/auth_vul_summary/dummy/get_cve_info"
                  "Method" = "POST"
                  "Body" = ($params | ConvertTo-Json)
                  "ContentType" = "application/json"
               }
               $cveResponse = Invoke-RestMethod @RestParams -WebSession $CyberCNSApiSession.Session
               $cveResponse
            }
         }
      }
   }
}
